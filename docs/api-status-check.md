# API 상태 확인 및 문제 해결

## 현재 상태

✅ **서버 실행**: 정상 작동 중
✅ **API 라우트**: 정상 생성됨
✅ **API 키 설정**: `.env.local`에 설정됨
✅ **결제 정보**: 추가 완료
🔄 **OpenAI API**: 테스트 필요 (서버 재시작 후 확인)

## 이전 문제 (해결됨)

```
OpenAI API 오류: 429 You exceeded your current quota
```

**해결 완료**: 결제 정보가 추가되었습니다. 서버를 재시작하면 정상 작동할 것입니다.

## 해결 방법

### 옵션 1: OpenAI 결제 정보 설정 (권장)

1. https://platform.openai.com/account/billing 접속
2. 결제 정보 추가
3. 사용량 한도 확인 및 조정

### 옵션 2: 폴백 메커니즘 사용 (현재 작동 중)

현재 구현된 폴백 메커니즘이 작동하므로:
- API 실패 시 자동으로 키워드 기반 매칭 사용
- 기본 기능은 정상 작동
- AI 매칭은 결제 설정 후 사용 가능

### 옵션 3: 다른 모델 사용

- Anthropic Claude Haiku (더 저렴)
- 로컬 모델 (Ollama 등)

## 테스트 방법

### 폴백 메커니즘 테스트

브라우저에서 다음을 입력해보세요:
```
환자는 평지에서 독립적으로 걷기가 가능하나, 계단 오르기 시 어려움을 보입니다.
```

키워드 매칭이 작동하여 다음 코드들이 매칭됩니다:
- d450 (걷기)
- d455 (이동하기)

### API 작동 확인

**⚠️ 중요: 서버 재시작 필요**

결제 정보를 추가한 후에는 반드시 개발 서버를 재시작해야 합니다:

```bash
# 현재 실행 중인 서버 중지 (Ctrl+C)
# 그 다음 다시 시작
npm run dev
```

테스트 방법:
1. 브라우저에서 `http://localhost:3000` 접속
2. 임상 언어 입력 예시:
   ```
   환자는 평지에서 독립적으로 걷기가 가능하나, 계단 오르기 시 어려움을 보입니다. 
   일상생활 활동 중 옷 입기와 식사는 독립적으로 수행 가능합니다.
   ```
3. "ICF 코드 찾기" 버튼 클릭
4. AI가 매칭한 ICF 코드 확인 (confidence 점수와 rationale 포함)
5. 키워드 매칭보다 더 정확하고 맥락을 이해한 결과를 확인할 수 있습니다

## 현재 작동하는 기능

✅ 임상 언어 입력
✅ **AI 기반 ICF 코드 매칭** (OpenAI GPT-3.5-turbo)
✅ 키워드 기반 ICF 코드 매칭 (폴백)
✅ 코드 선택
✅ 점수 입력
✅ 보고서 생성

## AI 매칭 기능 활성화됨

✅ OpenAI 결제 정보 설정 완료
✅ AI 기반 ICF 코드 매칭 기능 사용 가능

### AI 매칭의 장점

- **맥락 이해**: 키워드 매칭보다 더 정확한 의미 파악
- **신뢰도 점수**: 각 매칭에 대한 confidence 점수 제공
- **근거 설명**: rationale을 통해 매칭 이유 설명
- **다중 매칭**: 관련된 여러 ICF 코드를 동시에 찾아냄

### 향후 개선 가능 사항

1. **프롬프트 최적화**: Few-shot 예시 추가로 정확도 향상
2. **캐싱 구현**: 동일 입력에 대한 결과 캐싱으로 비용 절감
3. **점수 추론 기능**: 임상 언어 기반 점수 자동 제안
4. **다른 모델 옵션**: Anthropic Claude, 로컬 모델 등 추가 지원




