# Google 스프레드시트 연동 설정 가이드

평가 결과를 Google 스프레드시트에 자동으로 저장하는 기능을 설정하는 방법입니다.

## 📋 사전 준비사항

1. ✅ Google 계정
2. ✅ Google Apps Script 프로젝트가 이미 배포되어 있어야 함
3. ✅ Google 스프레드시트 생성 (또는 기존 스프레드시트 사용)

---

## 🚀 설정 단계

### 1단계: Google 스프레드시트 생성

1. **새 스프레드시트 생성**
   - https://sheets.google.com 접속
   - "빈 스프레드시트" 클릭
   - 또는 기존 스프레드시트 사용 가능

2. **스프레드시트 이름 변경** (선택사항)
   - 예: "ICF 평가 결과"

3. **스프레드시트 ID 복사**
   - URL에서 ID 확인:
     ```
     https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit
     ```
   - `SPREADSHEET_ID` 부분을 복사해두세요

---

### 2단계: Google Apps Script에 스프레드시트 ID 설정

1. **Google Apps Script 편집기 열기**
   - https://script.google.com 접속
   - ICF API 프로젝트 열기

2. **SpreadsheetService.gs 파일 추가**
   - 왼쪽 상단 `+` 버튼 클릭 → "스크립트" 선택
   - 파일 이름을 `SpreadsheetService`로 변경
   - `google-apps-script/SpreadsheetService.gs` 파일의 **전체 내용**을 복사하여 붙여넣기
   - 저장 (Ctrl+S 또는 Cmd+S)

3. **스크립트 속성에 스프레드시트 ID 추가**
   - 왼쪽 메뉴 ⚙️ 아이콘 → "프로젝트 설정"
   - "스크립트 속성" 섹션으로 스크롤
   - "스크립트 속성 추가" 클릭
   - 속성 추가:
     - **속성**: `SPREADSHEET_ID` (정확히 이 이름으로 입력)
     - **값**: 위에서 복사한 스프레드시트 ID
   - "저장 스크립트 속성" 클릭

---

### 3단계: Code.gs 업데이트

1. **Code.gs 파일 확인**
   - `save-assessment` 엔드포인트가 추가되어 있는지 확인
   - 없으면 `google-apps-script/Code.gs` 파일의 최신 버전으로 업데이트

2. **저장 후 새 버전 배포**
   - 저장 (Ctrl+S 또는 Cmd+S)
   - **배포** → **배포 관리**
   - 기존 배포 옆의 **"새 버전 편집"** 클릭
   - 새 버전 번호 입력 (예: `3`)
   - **"배포"** 클릭

---

### 4단계: 스프레드시트 권한 설정

1. **스프레드시트 공유 설정**
   - Google 스프레드시트 열기
   - 오른쪽 상단 "공유" 버튼 클릭
   - Google Apps Script를 실행하는 Google 계정에 **편집 권한** 부여
   - 또는 "링크가 있는 모든 사용자"에게 "편집자" 권한 부여 (공개 사용 시)

---

### 5단계: 테스트

1. **프론트엔드에서 테스트**
   - 평가 완료 후 "스프레드시트에 저장" 버튼 클릭
   - 저장 성공 메시지 확인
   - 스프레드시트 열기 확인

2. **스프레드시트 확인**
   - Google 스프레드시트 열기
   - "평가 결과" 시트가 생성되었는지 확인
   - 데이터가 올바르게 저장되었는지 확인

---

## 📊 저장되는 데이터 형식

스프레드시트에 다음 정보가 저장됩니다:

| 컬럼 | 설명 |
|------|------|
| 날짜/시간 | 평가가 저장된 시간 |
| 환자 이름 | 환자 정보 (있는 경우) |
| 성별 | 남/여 |
| 생년월일 | 환자 생년월일 |
| 진단명 | 진단명 |
| Core Set | 사용된 Core Set 이름 |
| ICF 코드 | 평가된 ICF 코드 |
| 도메인 | b/s/d/e |
| 평가 항목 | 평가 항목 제목 |
| 점수 | 평가 점수 |
| 메모 | 평가 메모 |
| 임상 언어 | 입력된 임상 언어 |
| 평가자 유형 | 치료사/보호자 |

---

## 🔧 문제 해결

### 문제 1: "스프레드시트 ID가 설정되지 않았습니다" 오류

**해결 방법:**
1. 프로젝트 설정 → 스크립트 속성 확인
2. 속성 이름이 정확히 `SPREADSHEET_ID`인지 확인 (대문자)
3. 스프레드시트 ID 값이 올바른지 확인
4. 저장 후 스크립트 재실행

### 문제 2: "권한이 거부되었습니다" 오류

**해결 방법:**
1. 스프레드시트 공유 설정 확인
2. Google Apps Script를 실행하는 계정에 편집 권한 부여
3. 스프레드시트를 다시 열어 권한 확인

### 문제 3: 시트가 생성되지 않음

**해결 방법:**
1. 스프레드시트 ID가 올바른지 확인
2. 스프레드시트에 접근 권한이 있는지 확인
3. Google Apps Script 실행 로그 확인

### 문제 4: 데이터가 저장되지 않음

**해결 방법:**
1. 브라우저 콘솔에서 오류 메시지 확인
2. Google Apps Script 실행 로그 확인
3. 네트워크 탭에서 API 응답 확인
4. 스프레드시트에 실제로 데이터가 추가되었는지 확인 (새로고침)

---

## 📝 참고사항

- 스프레드시트는 자동으로 "평가 결과" 시트를 생성합니다
- 시트가 이미 있으면 기존 시트를 사용합니다
- 각 평가는 별도의 행으로 저장됩니다
- 여러 ICF 코드를 평가하면 각 코드마다 별도의 행이 생성됩니다

---

## ✅ 체크리스트

설정 완료 확인:

- [ ] Google 스프레드시트 생성 완료
- [ ] 스프레드시트 ID 복사 완료
- [ ] SpreadsheetService.gs 파일 추가 완료
- [ ] 스크립트 속성에 SPREADSHEET_ID 설정 완료
- [ ] Code.gs에 save-assessment 엔드포인트 추가 확인
- [ ] 새 버전으로 배포 완료
- [ ] 스프레드시트 권한 설정 완료
- [ ] 테스트 성공 확인

---

## 🎉 완료!

이제 평가 결과가 자동으로 Google 스프레드시트에 저장됩니다!
