# Google Apps Script 설정 체크리스트

배포 전에 다음 항목들을 확인하세요.

## ✅ Google Apps Script 설정

### 1. 파일 업로드 확인
- [ ] `Code.gs` 파일이 생성되고 내용이 복사됨
- [ ] `ICFCodes.gs` 파일이 생성되고 내용이 복사됨
- [ ] `OpenAIService.gs` 파일이 생성되고 내용이 복사됨
- [ ] `Handlers.gs` 파일이 생성되고 내용이 복사됨

### 2. OpenAI API 키 설정
- [ ] 프로젝트 설정 → 스크립트 속성에 `OPENAI_API_KEY` 추가됨
- [ ] 속성 이름이 정확히 `OPENAI_API_KEY` (대문자)인지 확인
- [ ] API 키 값이 올바른지 확인 (`sk-`로 시작)

### 3. 배포 설정
- [ ] 배포 → 새 배포 → 웹 앱 선택
- [ ] 실행할 사용자: **"나"** 선택
- [ ] 액세스 권한: **"모든 사용자"** 선택
- [ ] 배포 URL 복사 완료

### 4. 배포 테스트
- [ ] 배포 URL을 브라우저에 붙여넣기
- [ ] GET 요청 시 JSON 응답 확인:
  ```json
  {
    "message": "ICF API 서버가 실행 중입니다.",
    "endpoints": ["match", "score-recommendation", "intervention-recommendation"],
    "version": "1.0.0"
  }
  ```

## ✅ 프론트엔드 설정

### 1. 환경 변수 설정
- [ ] `.env.local` 파일 생성 (프로젝트 루트)
- [ ] `NEXT_PUBLIC_GAS_API_URL` 환경 변수 추가
- [ ] 값이 올바른지 확인 (예: `https://script.google.com/macros/s/.../exec`)

### 2. 개발 서버 재시작
- [ ] 개발 서버 중지
- [ ] `npm run dev` 재실행
- [ ] 환경 변수가 로드되었는지 확인

## ✅ 기능 테스트

### 1. ICF 코드 매칭 테스트
- [ ] 임상 언어 입력 필드에 텍스트 입력
- [ ] "매칭하기" 버튼 클릭
- [ ] AI 매칭 결과가 표시되는지 확인
- [ ] 에러 발생 시 키워드 매칭으로 폴백되는지 확인

### 2. 점수 추천 테스트
- [ ] ICF 코드 선택 후 "점수 추천" 버튼 클릭
- [ ] AI 추천 점수가 표시되는지 확인
- [ ] 에러 발생 시 조용히 실패하는지 확인 (콘솔에 경고만 출력)

### 3. 중재 예시 추천 테스트
- [ ] 점수 입력 후 중재 예시 요청
- [ ] AI 중재 예시가 표시되는지 확인
- [ ] 에러 발생 시 조용히 실패하는지 확인 (콘솔에 경고만 출력)

## 🔍 문제 해결

### 문제: "OpenAI API 키가 설정되지 않았습니다"
**해결 방법:**
1. 프로젝트 설정 → 스크립트 속성 확인
2. 속성 이름이 정확히 `OPENAI_API_KEY`인지 확인
3. API 키 값이 올바른지 확인
4. 저장 후 스크립트 재실행

### 문제: "권한이 거부되었습니다"
**해결 방법:**
1. 배포 설정 확인:
   - 실행할 사용자: **"나"**
   - 액세스 권한: **"모든 사용자"**
2. 배포를 새로 생성
3. 권한을 다시 승인

### 문제: CORS 오류
**해결 방법:**
1. 배포 설정에서 액세스 권한이 **"모든 사용자"**로 설정되어 있는지 확인
2. 배포를 새로 생성
3. 브라우저 캐시 삭제 후 재시도

### 문제: "알 수 없는 엔드포인트" 오류
**해결 방법:**
1. 요청 본문에 `endpoint` 필드가 포함되어 있는지 확인
2. `endpoint` 값이 다음 중 하나인지 확인:
   - `match`
   - `score-recommendation`
   - `intervention-recommendation`

### 문제: 프론트엔드에서 API 호출이 안 됨
**해결 방법:**
1. `.env.local` 파일 확인
2. `NEXT_PUBLIC_GAS_API_URL` 환경 변수가 올바른지 확인
3. 개발 서버 재시작
4. 브라우저 콘솔에서 네트워크 요청 확인

## 📝 참고사항

- Google Apps Script는 무료로 사용할 수 있지만, 일일 실행 시간 제한이 있습니다 (6분/일)
- OpenAI API 호출은 별도로 비용이 발생합니다
- 배포 URL은 변경되지 않지만, 코드를 수정한 후에는 새 버전으로 배포해야 합니다
- Google Apps Script는 에러가 있어도 HTTP 200을 반환하므로, 프론트엔드에서 `data.error` 필드를 확인해야 합니다
